<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>the gnarly tyke</title>
    <link rel="stylesheet" href="stylesheets/default.css">
</head>
<body>
  <h1 class="main-header">the gnarly tyke</h1>
  <div>
    <h2 class="area-name">Scar Buttress at Baildon Bank</h2>
  </div>
  <div>
    <div>
      <img id="topo-image" src="./images/scar-wall-resize.jpg" style="display:none;">
    </div>
    <div style="margin-top: 2%;">
      <canvas style="margin: auto; display: block" id="topo-canvas"></canvas>
    </div>
    <div style="margin-top: 2%;">
      <table class="route-table" id="route-table" style="width: 80%; margin: auto">
        <thead>
            <tr>
              <th></th>
              <th>Name</th>
              <th>Type</th>
              <th>Grade</th>
            </tr>
        </thead>
        <tbody id="route-table-body">
          <script>
            let routes = 
            [
              { "name": "Scar Wall", "type": "Trad", "grade": "E5 6b" },
              { "name": "Scar", "type": "Trad", "grade": "E2 5b" },
              { "name": "The Flakes", "type": "Trad", "grade": "E3 5c" },
              { "name": "Intrepid", "type": "Trad", "grade": "E6 6a" }
            ];
            routes.forEach((route, index) => {
              let rowHTML = 
              `<tr>
                <td>${index+1}</td>
                <td>${route.name}</td>
                <td>${route.type}</td>
                <td>${route.grade}</td>
              </tr>
              `;
              document.write(rowHTML);
            });
          </script>
        </tbody>
      </table>
    </div>
  </div>
  <script>
    window.onload = function() {
      DrawCanvas();
    }
    window.onresize = () => {
      DrawCanvas();
    }
    let DrawCanvas = () => {
      var canvas = document.getElementById("topo-canvas");
      var ctx = canvas.getContext("2d");
      var img = document.getElementById("topo-image");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight * 0.6;
      const imageScale = canvas.height / img.height;
      const imageWidthOnCanvas = img.width * imageScale;
      const imageShiftRight = canvas.width / 2 - imageWidthOnCanvas / 2;
      ctx.drawImage(img, imageShiftRight, 0, imageWidthOnCanvas, canvas.height);
      const lines = [
      { "start": { "x": 0.30, "y": 0.80 }, "end": { "x": 0.34, "y": 0.15 } },
      { "start": { "x": 0.44, "y": 0.80 }, "end": { "x": 0.48, "y": 0.12 } },
      { "start": { "x": 0.56, "y": 0.80 }, "end": { "x": 0.55, "y": 0.12 } },
      { "start": { "x": 0.62, "y": 0.82 }, "end": { "x": 0.62, "y": 0.15 } }
      ]
      const transformedLines = lines.map(line => {
        return {
          "start": { "x": line.start.x * imageWidthOnCanvas + imageShiftRight, "y": line.start.y * canvas.height}, 
          "end": { "x": line.end.x * imageWidthOnCanvas + imageShiftRight, "y": line.end.y * canvas.height}
          };
      });
      transformedLines.forEach( line => {
        DrawLine(ctx, line);
      });
      const labels = lines.map((line, index) => { 
        return {"value": index + 1, "pos": { "x": line.start.x * imageWidthOnCanvas + imageShiftRight, "y": line.start.y * canvas.height } };
      });
      labels.forEach( label => {
        DrawLabel(ctx, label);
      });
    }
    let DrawLine = (ctx, line) => {
      const lineWidth = ctx.canvas.height * 0.01;
      const lineDash = ctx.canvas.height * 0.01;
      ctx.strokeStyle = 'white';
      ctx.beginPath();
      ctx.lineWidth = lineWidth;
      ctx.strokeStyle = '#FFFF';
      ctx.setLineDash([lineDash, lineDash]);
      ctx.moveTo(line.start.x, line.start.y);
      ctx.lineTo(line.end.x, line.end.y);
      ctx.stroke();
      ctx.beginPath();
      ctx.lineWidth = lineWidth * 0.75;
      ctx.strokeStyle = '#0a5f16';
      ctx.moveTo(line.start.x, line.start.y);
      ctx.lineTo(line.end.x, line.end.y);
      ctx.stroke();
    }
    let DrawLabel = (ctx, label) => {
      const size = ctx.canvas.height * 0.02;
      const fontSize = size * 2;
      ctx.beginPath();
      ctx.setLineDash([]);
      ctx.arc(label.pos.x, label.pos.y, size, 0, 2 * Math.PI, false);
      ctx.fillStyle = "#FFFFFF";
      ctx.fill();
      ctx.beginPath();
      ctx.arc(label.pos.x, label.pos.y, size, 0, 2 * Math.PI, false);
      ctx.lineWidth = size * 0.1;
      ctx.strokeStyle = "#000000";
      ctx.stroke();
      ctx.font = `bold ${fontSize}px serif`;
      ctx.fillStyle = "#000000";
      ctx.fillText(label.value, label.pos.x - (size * 0.5), label.pos.y + (size * 0.75));
    }
    let MapToCanvas = (canvas, pos) => {
      return { "x": canvas.width * pos.x, "y": canvas.height * pos.y };
    }
    </script>
</body>
</html>
