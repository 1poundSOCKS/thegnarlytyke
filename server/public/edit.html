<!DOCTYPE html>
<meta charset="UTF-8">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <title>the gnarly tyke</title>
    <link rel="stylesheet" href="stylesheets/default.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
  <div><h1>the gnarly tyke</h1></div>
  <div><h2>Baildon Bank</h2><div>
  <div id="topo-images-container" class="topo-images-container"></div>
  <div class="do-not-display"><p id="current-topo-id"></p></div>
  <div id="main-topo-container" class="main-topo-container do-not-display">
    <canvas id="main-topo-image" class="main-topo-image"></canvas>
    <table id="topo-route-table" class="new-topo-route-table">
      <thead class="topo-route-table-header">
          <tr>
            <th></th>
            <th>Name</th>
            <th>Grade</th>
          </tr>
      </thead>
    </table>
  </div>
  <script src="./bundle.js"></script>
  <script>
    let _cragObject = null;
    let _selectedTopoImageContainer = null;
    window.onload = () => {
      fetch('./data/crag.json')
      .then(response => response.json())
      .then(crag => {
        _cragObject = CreateCragObject(crag);
        let cragTopoIDs = GetCragTopoIDs(_cragObject);
        let topoImageContainers = cragTopoIDs.map( topoID => {
          return document.getElementById('topo-images-container').appendChild(CreateTopoImageContainer(topoID));
        });
        let topoImageFilenames = cragTopoIDs.map( id => GetTopoImageFile(_cragObject, id) );
        cragTopoIDs.forEach( (topoID, index) => {
          let imageFilename = GetTopoImageFile(_cragObject, topoID);
          if( imageFilename ) {
            LoadImage(`./images/${imageFilename}`)
            .then( topoImage => {
              let topoCanvases = [];
              let topoCanvas = CreateCanvasAndDisplayTopoImage(topoImage, topoImageContainers[index]);
              DrawMainTopoOverlay(_cragObject, topoID);
              RefreshTopoRouteTable(_cragObject, topoID);
              topoCanvas.onclick = event => {
                if( _selectedTopoImageContainer ) _selectedTopoImageContainer.classList.remove('topo-container-selected');
                _selectedTopoImageContainer = topoImageContainers[index];
                _selectedTopoImageContainer.classList.add('topo-container-selected');
                DrawMainTopoImage(topoImage);
                DrawMainTopoOverlay(_cragObject, topoID);
                RefreshTopoRouteTable(_cragObject, topoID);
                document.getElementById('main-topo-container').classList.remove('do-not-display');
              }
            });
          }
        });
      });
    }
    window.onresize = () => {
    }
    </script>
</body>
</html>
